//================================================================
//  gmoconv configuration
//================================================================

usage {
	puts "usage:"
	puts "        gmoconv <input files> [options]"
	puts "options:"
	puts "        -interact       input additional options"
	puts "        -models         merge files as models"
	puts "        -motions        merge files as motions"
	puts "        -textures       merge files as textures"
	puts "        -prompt         prompt always"
	puts "        -warning        prompt on warning"
	puts "        -error          prompt on error"
	puts "        -viewer         start gmoview.exe when process ends"
	puts "        -o <filename>   specify output file name"
	puts "        -s <scale>      resize geometry data"
	puts "        -t <scale>      resize motion length"
	puts "        -r <fps>        specify motion frame rate"
	puts "        -O, -O2         optimize"
	puts "        -S              output text format"
	puts "        -H              output header file"
	puts "        -Z              use compact vertex format"
	puts "        -Q              use sequential vertex primitives"
}

//----------------------------------------------------------------
//  default settings
//----------------------------------------------------------------

default {
	load "lib/*"

	//  main control

	interact_mode = ctrl		// off on
	merge_mode = off		// off model motion texture
	prompt_mode = off		// off on warning error
	debug_mode = off		// off on
	stat_mode = on			// off on
	output_object = on		// off on
	output_script = off		// off on
	output_header = off		// off on
	output_directory = auto		// current input auto
	output_filename = ""
	object_extension = .gmo
	script_extension = .gms
	header_extension = .inc
	batch_extension = .bat
	image_extension = .tm2 .gim .tga .bmp
	image_extension2 = .tm2 .tga .bmp .gis .dds .png .avi
	image_converter = "../gimconv/GimConv.exe -o %tmpfile -F"
	//image_converter = "../gimconv/GimConv.exe -o %curfile -F"
	object_viewer = ""		// GmoView.exe
	definition_file = ""		// GmoConv.def
	check_direct_option = warning	// off on warning error
	match_motion_target = on	// off on
	match_motion_basepose = on	// off on

	//  process control

	filter_script = "Filter"
	filter_script2 = "Filter2"
	geom_scale = 1.0		// $scale
	time_scale = 1.0		// $scale
	frame_loop = default		// default off on $start,$end
	frame_rate = 30		// default off on $fps
	frame_repeat = default		// default off on hold cycle

	import_image = on		// off on
	rebuild_bounding = on		// off on model bone part mesh
	rebuild_bounding_points = off	// off on model bone part mesh obb aabb
	rebuild_triangle = on		// off on
	rebuild_tristrip = on		// off on
	rebuild_line = off		// off on
	rebuild_linestrip = off		// off on
	rebuild_faceedge = off		// off on noedge noface $angle
	rebuild_faceedge2 = off		// off on noedge $angle
	rebuild_rectpatch = off		// off on
	rebuild_keyframe = off		// off on
	rebuild_quaternion = off	// off on
	optimize_bone = off		// off on $filename
	unify_material = off		// off on
	unify_texture = off		// off on
	unify_mesh = off		// off on arrays
	unify_arrays = on		// off on
	unify_vertex = on		// off on
	unweld_mesh = off		// off on
	unweld_vertex = off		// off on
	sort_type = on			// off on block command partition
	sort_name = off			// off on model bone part material texture motion
	sort_transparency = off		// off on bone part mesh
	remove_unresolved = off		// off on bone part arrays material texture fcurve
	remove_unused = off		// off on part arrays material texture fcurve
	remove_single_weight = off	// off on
	flip_normal = off		// off on
	flip_patch = off		// off u v uv
	freeze_patchuv = on		// off on
	freeze_texcrop = off		// off on
	check_limit = on		// off on

	epsilon_translate = 0.001	// $epsilon
	epsilon_rotate = 0.001		// $epsilon
	epsilon_scale = 0.001		// $epsilon
	epsilon_misc = 0.001		// $epsilon
	epsilon_static = -1.0		// $epsilon

	blend_cost_mesh = infinite	// $cycles infinite
	blend_cost_matrix = 80		// $cycles
	blend_cost_weight = 10		// $cycles
	blend_cost_strip = 2		// $cycles

	//  binary output control

	output_name = on		// off on
	output_anchor = off		// off on auto
	output_bone = on		// off on only
	output_part = on		// off on only
	output_material = on		// off on only
	output_texture = on		// off on only
	output_motion = on		// off on only

	format_style = psp		// std psp
	format_fname = full		// full tail root lower upper
	format_color = default		// default float rgba8888
	format_index = default		// default u_short off
	format_keyframe = default	// default float half

	format_vertex = short		// default float short char
	format_normal = short		// default float short char
	format_vcolor = rgba5551		// default rgba8888 rgba5650 rgba5551 rgba4444
	format_tcoord = u_short		// default float u_short u_char
	format_weight = u_char		// default float u_short u_char
	offset_vertex = auto		// auto $scale $scale,$x,$y,$z
	offset_tcoord = auto		// auto $scale $scale,$x,$y

	limit_bone = off		// off $count ${size}KB
	limit_part = off		// off $count ${size}KB
	limit_material = off		// off $count ${size}KB
	limit_texture = off		// off $count ${size}KB
	limit_motion = off		// off $count ${size}KB

	align_image = off		// off $align

	//  gmp output control

	gmp_model_packet = motion	// off on motion
	gmp_motion_packet = on		// off on
	gmp_texture_packet = on		// off on
	gmp_model_list = signal		// call signal
	gmp_geometry_list = call	// call signal inline
	gmp_material_list = call	// call signal inline
	gmp_texture_list = call		// call signal inline
	gmp_frame_step = 1		// $step ${fps}FPS

	//  xsi input control

	xsi_vcolor_lighting = off	// off on
	xsi_vcolor_specular = off	// off on
	xsi_ignore_textrans = auto	// off on auto
	xsi_ignore_prefix = off		// off on
	xsi_check_custom_param = on	// off on $prefix
	xsi_custom_param_transform = on	// off on $prefix
	xsi_custom_param_material = on	// off on $prefix
	xsi_custom_param_userdata = off	// off on $prefix
	xsi_shiny_scale = 1.0

	//  fbx input control

	fbx_time_mode = off		// off on 24 25 30 48 50 60
	fbx_output_root = off		// off on
	fbx_filter_fcurve = off		// off on auto
	fbx_filter_transp = on		// off on
	fbx_use_material_name = on	// off on
	fbx_use_texture_name = on	// off on
	fbx_default_vcolor = on		// off on $color
	fbx_check_maya_ascii = on	// off on
	fbx_maya_notes_transform = on	// off on $prefix
	fbx_maya_notes_material = on	// off on $prefix
	fbx_maya_notes_userdata = off	// off on $prefix
	fbx_shiny_scale = 4.0

	//  directive control

	source_define = on		// off on
	source_option = on		// off on
	output_define = off		// off on
	output_option = off		// off on
}

//--------------------------------------------------------
//  format specific
//--------------------------------------------------------

input *.xsi {
	load "ImportXSI"

	unify_material = on
	unify_texture = on
}

input *.fbx {
	load "ImportFBX"

	unify_material = on
	unify_texture = on
}

input *.dae {
	load "ImportFBX"

	unify_material = on
	unify_texture = on
}

input *.gms {
}

input *.gmo {
}

//--------------------------------------------------------
//  mode option
//--------------------------------------------------------

option -interact {
	interact_mode = on
}

option -models {
	merge_mode = model
}

option -motions {
	merge_mode = motion
}

option -textures {
	merge_mode = texture
	unify_texture = on
	output_bone = off
	output_part = off
	output_material = off
	output_texture = on
	output_motion = off
}

option -levels {
	merge_mode = level
}

option -prompt {
	prompt_mode = on
}

option -warning {
	prompt_mode = warning
}

option -error {
	prompt_mode = error
}

option -viewer {
	object_viewer = "GmoView.exe"
}

//--------------------------------------------------------
//  parameter option
//--------------------------------------------------------

option -o %filename {
	output_filename = %filename
}

option -s %scale {
	geom_scale = %scale
}

option -t %scale {
	time_scale = %scale
}

option -r %fps {
	frame_rate = %fps
}

//--------------------------------------------------------
//  optimize option
//--------------------------------------------------------

option -O {
	rebuild_bounding = model bone part
	// rebuild_bounding_points = mesh
	rebuild_tristrip = on
	rebuild_keyframe = on

	// unify_material = on
	// unify_texture = on
	// unify_mesh = arrays
	// unify_arrays = on
	unify_vertex = on

	// blend_cost_mesh = 300
}

option -O2 {
	rebuild_bounding = model bone part
	// rebuild_bounding_points = mesh
	rebuild_tristrip = on
	rebuild_keyframe = on

	optimize_bone = on
	sort_transparency = on
	freeze_patchuv = on
	freeze_texcrop = on

	// unify_material = on
	// unify_texture = on
	// unify_mesh = arrays
	// unify_arrays = on
	unify_vertex = on

	// blend_cost_mesh = 300
}

//--------------------------------------------------------
//  output option
//--------------------------------------------------------

option -S {
	output_script = on
}

option -H {
	output_header = on
}

option -Z {
	format_vertex = short
	format_normal = short
	format_vcolor = rgba4444
	format_tcoord = u_short
	format_weight = u_char
}

option -Q {
	unweld_vertex = on
	format_index = off
}

//--------------------------------------------------------
//  filter script
//--------------------------------------------------------

script Filter %target {
	CompFCurveChannel	%target on
	CompVertexWeight	%target on

	ScaleGeometry		%target $geom_scale
	ScaleTime		%target $time_scale
	SetFrameLoop		%target $frame_loop
	SetFrameRate		%target $frame_rate
	SetFrameRepeat		%target $frame_repeat

	FlipNormal		%target $flip_normal
	FlipPatch		%target $flip_patch
	FreezePatchUV		%target $freeze_patchuv
	FreezeTexCrop		%target $freeze_texcrop

	UnifyVertex		%target $unify_vertex
	UnifyTexture		%target $unify_texture
	UnifyMaterial		%target $unify_material
	UnifyMesh		%target $unify_mesh
	LimitVertexBlend	%target 6
	UnifyArrays		%target $unify_arrays

	RebuildBounding		%target $rebuild_bounding
	RebuildBoundingPoints	%target $rebuild_bounding_points
	RebuildTriangle		%target $rebuild_triangle
	RebuildTriStrip		%target $rebuild_tristrip
	RebuildFaceEdge		%target $rebuild_faceedge
	// RebuildFaceEdge2	%target $rebuild_faceedge2
	RebuildLine		%target $rebuild_line
	RebuildLineStrip	%target $rebuild_linestrip
	RebuildRectPatch	%target $rebuild_rectpatch
	RebuildQuaternion	%target $rebuild_quaternion

	UpdateFileImage		%target $import_image
}

script Filter2 %target {
	OptimizeBone		%target $optimize_bone
	RebuildKeyFrame		%target $rebuild_keyframe
	RemoveUnresolved	%target $remove_unresolved
	RemoveUnused		%target $remove_unused
	RemoveSingleWeight	%target $remove_single_weight

	SortByTransparency	%target $sort_transparency
	SortByName		%target $sort_name
	SortByType		%target $sort_type

	UnweldMesh		%target $unweld_mesh
	UnweldVertex		%target $unweld_vertex
	RebuildFaceEdge2	%target $rebuild_faceedge2
	CheckPSP		%target $check_limit
}
